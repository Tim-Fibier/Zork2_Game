package ch.bbw.zork;import java.util.*;/** * Class Game - the main class of the "Zork" game. * * Author:  Michael Kolling, 1.1, March 2000 * refactoring: Rinaldo Lanza, September 2020 */public class Game {	private Parser parser;	public Room currentRoom;	public Room outside, lab, tavern, gblock, office, armory, library, garden, kitchen, dungeon, exit;    /*    Spielerinventar    */	private List<Keycard> playerInventory;	private List<Item> playerItems;	private QuestionPool questionPool;	/*    ArrayList aller Räume für die map-Funktion    */	private ArrayList<Room> allRooms;	/*    Maximales Tragegewicht    */	private static final int MAX_WEIGHT = 10;	private Backpack equippedBackpack;	// ← NEUE VARIABLE:	private Room previousRoom;  // Speichert den vorherigen Raum	/*    Konstruktor - initialisiert das Spiel    */	public Game() {		parser = new Parser(System.in);		playerInventory = new ArrayList<>();		playerItems = new ArrayList<>();		questionPool = new QuestionPool();		allRooms = new ArrayList<>();		// Erstelle alle Räume		outside = new Room("outside G block on Peninsula campus");		lab = new Room("lab, a lecture theatre in A block");		tavern = new Room("the Seahorse Tavern (the campus pub)");		gblock = new Room("the G Block");		office = new Room("the computing admin office");		armory = new Room("the armory room");		library = new Room("the library");		garden = new Room("the garden");		kitchen = new Room("the kitchen");		dungeon = new Room("the dungeon");		exit = new Room("the exit - freedom awaits!");		// Füge alle Räume zur Liste hinzu		allRooms.add(outside);		allRooms.add(lab);		allRooms.add(tavern);		allRooms.add(gblock);		allRooms.add(office);		allRooms.add(armory);		allRooms.add(library);		allRooms.add(garden);		allRooms.add(kitchen);		allRooms.add(dungeon);		allRooms.add(exit);       /*       Setze die Ausgänge zwischen den Räumen       */		outside.setExits(garden, lab, gblock, tavern);		lab.setExits(null, null, office, outside);		tavern.setExits(null, outside, null, kitchen);		gblock.setExits(outside, null, armory, null);		office.setExits(lab, null, null, null);		library.setExits(null, garden, null, null);		armory.setExits(gblock, null, null, dungeon);		garden.setExits(exit, null, outside, library);		kitchen.setExits(null, tavern, null, null);		dungeon.setExits(null, armory, null, null);       /*       Erstelle Keycards - Denis		// Erstellt 3 Keycards:		Red (öffnet Dungeon, ID 1),		Blue (öffnet Armory, ID 2),		Green (öffnet Exit, ID 3)       */		Keycard redKeycard = new Keycard("Red", "A red keycard that opens the dungeon", 3, "unlock_dungeon", 1);		Keycard blueKeycard = new Keycard("Blue", "A blue keycard that opens the armory", 3, "unlock_armory", 2);		Keycard greenKeycard = new Keycard("Green", "A green keycard - your ticket to freedom", 4, "unlock_exit", 3);       /*       Erstelle Quests mit zufälligen Fragen - Denis   	   Erstellt drei Quests mit zufälligen Fragen:   	   Büro: Gibt blueKeycard, Frage aus questionPool       Bibliothek: Gibt redKeycard, Frage aus questionPool       Küche: Gibt greenKeycard, Frage aus questionPool       Jede Quest wird an das passende Raumobjekt gehängt.	   */		Quest officeQuest = new Quest(				"A locked filing cabinet holds a keycard.",				questionPool.getRandomQuestion(),				blueKeycard		);		office.setQuest(officeQuest);		Quest libraryQuest = new Quest(				"An ancient book lies open with a challenge.",				questionPool.getRandomQuestion(),				redKeycard		);		library.setQuest(libraryQuest);		Quest kitchenQuest = new Quest(				"A safe behind the stove has a puzzle lock.",				questionPool.getRandomQuestion(),				greenKeycard		);		kitchen.setQuest(kitchenQuest);        /*        Erstelle Items - Denis		Erstellt 4 Items und einen Rucksack:		Flashlight: Gewicht 2, Typ "light" (zeigt versteckte Wege)		Map: Gewicht 1, Typ "navigation" (Campus-Karte)		Sword: Gewicht 5, Typ "weapon" (Schutz)		Book: Gewicht 2, Typ "knowledge" (mystische Symbole)		Backpack: Leerer Rucksack zum Sammeln der Items		*/		Item flashlight = new Item("Flashlight", "A bright flashlight that reveals hidden paths", 2, "light");		Item map = new Item("Map", "A detailed campus map", 1, "navigation");		Item heavySword = new Item("Sword", "A heavy ancient sword - provides protection", 5, "weapon");		Item book = new Item("Book", "An ancient book with mysterious symbols", 2, "knowledge");		Backpack backpack = new Backpack();       /*       Platziere Items in Räumen       */		lab.addItem(flashlight);		office.addItem(map);		office.addItem(backpack);		armory.addItem(heavySword);		library.addItem(book);       /*       Map direkt ins Spielerinventar legen       */		playerItems.add(map);       /*       Startposition       */		currentRoom = outside;	}	/*    Hauptspielschleife    */	public void play() {		printWelcome();		boolean finished = false;		while (!finished) {			Command command = parser.getCommand();			finished = processCommand(command);		}		System.out.println("Thank you for playing.  Good bye.");	}	/*    Zeigt Willkommensnachricht    */	private void printWelcome() {		System.out.println();		System.out.println("Welcome to Zork!");		System.out.println("Zork is a simple adventure game.");		System.out.println("Type 'help' if you need help.");		System.out.println();		System.out.println(currentRoom.longDescription());	}	/*    Verarbeitet Benutzerbefehle    */	private boolean processCommand(Command command) {		if (command.isUnknown()) {			System.out.println("I don't know what you mean...");			return false;		}		String commandWord = command.getCommandWord();		if (commandWord.equals("help")) {			printHelp();		} else if (commandWord.equals("answer")) {			answerQuest(command);		} else if (commandWord.equals("go")) {			goRoom(command);		} else if (commandWord.equals("back")) {			goBack();		} else if (commandWord.equals("inventory")) {			showInventory();		} else if (commandWord.equals("map")) {			showMap();		} else if (commandWord.equals("take")) {			pickUpItem(command);		} else if (commandWord.equals("drop")) {			putDownItem(command);		} else if (commandWord.equals("quit")) {			if (command.hasSecondWord()) {				System.out.println("Quit what?");			} else {				return true;			}		}		return false;	}	/*    Zeigt verfügbare Befehle    */	private void printHelp() {		System.out.println("You are lost. You are alone. You wander");		System.out.println("around at Monash Uni, Peninsula Campus.");		System.out.println();		System.out.println("Your command words are:");		System.out.println(parser.showCommands());	}	/*    Bewegungslogik zwischen Räumen    */	private void goRoom(Command command) {		if (!command.hasSecondWord()) {			System.out.println("Go where?");		} else {			String direction = command.getSecondWord();			Room nextRoom = currentRoom.nextRoom(direction);			if (nextRoom == null) {				System.out.println("There is no door!");			} else {				previousRoom = currentRoom;  // ← NEUE ZEILE: Speichern vor Raumwechsel				/*				BLUE KEYCARD: Armory braucht Blue Keycard				*/				if (currentRoom == gblock && direction.equals("east") && !hasKeycard("Blue")) {					System.out.println("The armory door is locked! You need the BLUE keycard.");					return;				}				/*				RED KEYCARD: Dungeon braucht Red Keycard				*/				if (currentRoom == armory && direction.equals("south") && !hasKeycard("Red")) {					System.out.println("The dungeon door is locked! You need the RED keycard.");					return;				}				/*				GREEN KEYCARD: Exit braucht Green Keycard - Denis				*/				if (currentRoom == garden && direction.equals("north")) {					if (!hasKeycard("Green")) {						System.out.println("The exit is locked! You need the GREEN keycard to escape!");						return;					} else {						System.out.println("\n=================================");						System.out.println("CONGRATULATIONS!");						System.out.println("Du hast das Spiel gewonnen!");						System.out.println("You escaped with the GREEN keycard!");						System.out.println("=================================\n");						System.exit(0);					}				}				currentRoom = nextRoom;				System.out.println(currentRoom.longDescription());				if (currentRoom == lab) {					System.out.println("Das Fenster ist offen, brrrrrrr");				}			}		}	}	/*    Geht einen Raum zurück    */	private void goBack() {		if (previousRoom != null) {			Room temp = currentRoom;      // Aktuellen Raum speichern			currentRoom = previousRoom;   // Zurück gehen			previousRoom = temp;          // Neuer previousRoom = alter currentRoom			System.out.println(currentRoom.longDescription());		} else {			System.out.println("No previous room! You can't go back further.");		}	}	/*    Prüft, ob Spieler eine bestimmte Keycard hat    */	private boolean hasKeycard(String color) {		for (Keycard keycard : playerInventory) {			if (keycard.getName().equalsIgnoreCase(color)) {				return true;			}		}		return false;	}	/*    Zeigt das Inventar des Spielers    */	private void showInventory() {		System.out.println("\n=== Your Inventory ===");		System.out.println("Weight: " + getCurrentWeight() + "/" + MAX_WEIGHT);		if (playerInventory.isEmpty() && playerItems.isEmpty()) {			System.out.println("Your inventory is empty.");		} else {			if (!playerInventory.isEmpty()) {				System.out.println("\nKeycards:");				for (Keycard keycard : playerInventory) {					System.out.println("  - " + keycard.getName() + " Keycard (Weight: " + keycard.getWeight() + ")");				}			}			if (!playerItems.isEmpty()) {				System.out.println("\nItems:");				for (Item item : playerItems) {					System.out.println("  - " + item.getName() + " (Weight: " + item.getWeight() + ")");				}			}		}		System.out.println("Keycards collected: " + playerInventory.size() + "/3\n");	}	/*    Beantwortet eine Quest    */	private void answerQuest(Command command) {		if (!command.hasSecondWord()) {			System.out.println("Answer what?");			return;		}		if (!currentRoom.hasQuest()) {			System.out.println("There is no quest here.");			return;		}		String answer = command.getSecondWord();		Quest quest = currentRoom.getQuest();		if (quest.checkAnswer(answer)) {			Keycard reward = quest.complete();			/*			Prüfe Gewicht vor dem Aufnehmen			*/			if (getCurrentWeight() + reward.getWeight() <= MAX_WEIGHT) {				playerInventory.add(reward);				System.out.println("\nCorrect! You received: " + reward.getName() + " Keycard (Weight: " + reward.getWeight() + ")");				System.out.println("Current weight: " + getCurrentWeight() + "/" + MAX_WEIGHT);				/*				Zeige an welche Tür die Keycard öffnet				*/				if (reward.getName().equals("Blue")) {					System.out.println("The BLUE keycard opens the Library door!");				} else if (reward.getName().equals("Red")) {					System.out.println("The RED keycard opens the Kitchen door!");				} else if (reward.getName().equals("Green")) {					System.out.println("The GREEN keycard opens the EXIT - you can escape through the garden!");				}			} else {				/*				Keycard wird in Raum gelegt wenn zu schwer				*/				currentRoom.addKeycard(reward);				System.out.println("\nCorrect answer! But you can't carry the " + reward.getName() + " Keycard - too heavy!");				System.out.println("The keycard has been dropped in this room.");				System.out.println("Drop some items first, then pick it up with 'take " + reward.getName().toLowerCase() + "'");				System.out.println("(Max weight: " + MAX_WEIGHT + ")");				System.out.println("Current weight: " + getCurrentWeight() + "/" + MAX_WEIGHT);			}		} else {			System.out.println("Wrong answer.");		}	}	/*    Nimmt ein Item auf    */	private void pickUpItem(Command command) {		if (!command.hasSecondWord()) {			System.out.println("Take what?");			return;		}		String itemName = command.getSecondWord();       /*       Versuche Keycard aufzunehmen       */		Keycard keycard = currentRoom.removeKeycard(itemName);		if (keycard != null) {			if (getCurrentWeight() + keycard.getWeight() <= MAX_WEIGHT) {				playerInventory.add(keycard);				System.out.println("You picked up: " + keycard.getName() + " Keycard (Weight: " + keycard.getWeight() + ")");				System.out.println("Current weight: " + getCurrentWeight() + "/" + MAX_WEIGHT);			} else {				currentRoom.addKeycard(keycard);  // Zurück in Raum				System.out.println("Too heavy! You can't carry that. (Max weight: " + MAX_WEIGHT + ")");				System.out.println("Current weight: " + getCurrentWeight() + "/" + MAX_WEIGHT);			}			return;		}       /*       Versuche Item aufzunehmen       */		Item item = currentRoom.removeItem(itemName);		if (item != null) {			if (getCurrentWeight() + item.getWeight() <= MAX_WEIGHT) {				playerItems.add(item);				System.out.println("You picked up: " + item.getName() + " (Weight: " + item.getWeight() + ")");				System.out.println(item.getDescription());				System.out.println("Current weight: " + getCurrentWeight() + "/" + MAX_WEIGHT);			} else {				currentRoom.addItem(item);				System.out.println("Too heavy! You can't carry that. (Max weight: " + MAX_WEIGHT + ")");				System.out.println("Current weight: " + getCurrentWeight() + "/" + MAX_WEIGHT);			}		} else {			System.out.println("That item is not here.");		}	}	/*    Legt ein Item ab    */	private void putDownItem(Command command) {		if (!command.hasSecondWord()) {			System.out.println("Drop what?");			return;		}		String itemName = command.getSecondWord();       /*       Versuche Keycard abzulegen       */		for (Keycard keycard : playerInventory) {			if (keycard.getName().equalsIgnoreCase(itemName)) {				playerInventory.remove(keycard);				currentRoom.addKeycard(keycard);				System.out.println("You dropped: " + keycard.getName() + " Keycard");				System.out.println("Current weight: " + getCurrentWeight() + "/" + MAX_WEIGHT);				return;			}		}       /*       Versuche Item abzulegen       */		for (Item item : playerItems) {			if (item.getName().equalsIgnoreCase(itemName)) {				playerItems.remove(item);				currentRoom.addItem(item);				System.out.println("You dropped: " + item.getName());				System.out.println("Current weight: " + getCurrentWeight() + "/" + MAX_WEIGHT);				return;			}		}		System.out.println("You don't have that item.");	}	/*    Zeigt die Campus-Karte    */	private void showMap() {		// Prüfe ob Spieler das Map-Item hat		boolean hasMap = false;		for (Item item : playerItems) {			if (item.getName().equalsIgnoreCase("map")) {				hasMap = true;				break;			}		}       /*       Gebe Map aus       */		System.out.println("\n==== CAMPUS MAP ====");		System.out.println();		for (Room room : allRooms) {			if (room == currentRoom) {				System.out.println(">>> YOU ARE HERE <<<");			}			System.out.println("Room: " + room.getDescription());			if (!room.getItems().isEmpty()) {				System.out.println("   Items:");				for (Item item: room.getItems()) {					System.out.println("   - " + item.getName());				}			}			if (room.hasQuest() && !room.getQuest().isCompleted()) {				System.out.println("  Keycard: " + room.getQuest().getReward().getName() + " (Quest available)");			} else if (room.hasQuest() && room.getQuest().isCompleted()) {				System.out.println("  Quest: completed");			} else {				System.out.println("  Quest: none");			}			System.out.println();		}		System.out.println("============================\n");	}	/*    Berechnet das aktuelle Gewicht    */	private int getCurrentWeight() {		int totalWeight = 0;		for (Keycard keycard : playerInventory) {			totalWeight += keycard.getWeight();		}		for (Item item : playerItems) {			totalWeight += item.getWeight();		}		return totalWeight;	}}